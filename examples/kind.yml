sma:
  version: 0.0.1
  services:
    prometheus:
      address: http://localhost:9090 # through port forward
  observation:
    mode: timer # triggger (python function that blocks), timer (based on window settings), continuous (collects data until stopped, with python function that blocks)
    window:
      left: 2s
      right: 2s
      duration: 5s
    targets:
      # target name to be referenced later
      - name: suo
        namespace: monitoring
    # environment:
    #   collector: prometheus
  measurements:
    # we are using python string templating, you can (and should) specify where additional labels with ${SMA_SELECTORS} otherwise results might be unfiltered
    - system_CPU: # name of the measurment in the report
        type: aggregate # type of the measurment (raw, aggregate) 
        layer: pod # layer of the measurment (pod, node, container)
        query: sum(rate(container_cpu_usage_seconds_total{namespace="${namespace}"}[1m]))
        step: 30 # sampling step in seconds
        unit: cpu_time_seconds # unit of the measurment
        target:
          - all # target name defined in the observation section (all for all targets)
    - system_CPU_1:
        type: raw
        query: container_cpu_usage_seconds_total{namespace="${namespace}"}
        step: 30
        unit: cpu_time_seconds
        target: 
          - suo
    - pod_power_consumption_kepler_watts:
        type: aggregate
        layer: pod
        query: sum by (pod_name) (rate(kepler_container_joules_total{container_namespace="${namespace}"}[1m]))
        unit: watts
        step: 30
        target:
          - suo
    - pod_power_consumption_kepler_old_watts:
        type: aggregate
        layer: pod
        unit: watts
        query: sum by (pod_name) (rate(kepler_container_core_joules_total[1m]))
        step: 30
        target:
          - suo
    - node_power_consumption_kepler:
        type: aggregate
        layer: node
        query: sum by (node) (rate(kepler_node_cpu_joules_total[1m]))
        unit: watts
        step: 30
        target:
          - suo
    - process_power_consumption:
        type: raw
        layer: pod
        query: kepler_process_joules_total{container_namespace="${namespace}"}
        unit: joules
        step: 30
        target:
          - suo
  report:
    format: csv
    location: reports/${startTime}_${runHash}/  # Can use ${runHash}, ${startTime}, and any run_extras keys
    filename: "${name}.csv"  # Must NOT contain path separators - ${name} is mandatory